# Stock Project - MLOps Pipeline

This project implements a comprehensive machine learning pipeline for stock market data using **Kedro**. It is designed to handle the full lifecycle of a time-series classification model with a strong focus on reproducibility, interpretability, and MLOps best practices.

---

## Pipeline Implementation Details

### 1. Data Preprocessing

The preprocessing pipeline handles raw stock data and transforms it into a format suitable for modeling. This involves:

- **Feature Engineering:** Creating domain-specific features such as technical indicators.
- **Target Creation:** Defining the prediction target (e.g., future price movement).
- **Data Widening:** Expanding features across different time windows or instruments.
- **Model Input Preparation:** Aligning and formatting features and labels into clean datasets.

**Outputs:**
- `preprocessed_data`: The cleaned and feature-rich dataset.
- `feature_store_versions`: Metadata tracking feature versions for reproducibility.

---

### 2. Data Splitting

A critical step for time-series data, the splitting ensures that training and testing sets respect chronological order to prevent data leakage.

- Uses a custom split function that sorts by date and splits without shuffling.
- Tracks split parameters and dataset sizes in **MLflow** for auditability.

**Outputs:**
- `X_train`, `X_test`: Feature sets for training and testing.
- `y_train`, `y_test`: Corresponding labels.

---

### 3. Feature Selection: `KBestRFESelector`

This custom sklearn transformer combines two powerful techniques:

- **SelectKBest:** Selects top `k` features based on univariate statistical tests (default: ANOVA F-value).
- **Recursive Feature Elimination (RFE):** Further refines the selection to `n_features_to_select` using a model-based ranking, typically a Random Forest.

This layered approach balances statistical relevance and model performance to reduce dimensionality effectively.

---

### 4. Feature Scaling: `FeatureScaler`

Financial time series often contain heterogeneous feature scales (e.g., RSI ranges 0-100 vs ATR measuring volatility). This class automates scaler selection per feature using heuristics:

- **MinMaxScaler:** For bounded features like RSI.
- **RobustScaler:** For features with outliers.
- **StandardScaler:** Default for normally distributed features.

Scaler choices and feature statistics are logged for MLOps monitoring and model interpretation.

---

### 5. Cross-Validation: `PurgedKFold`

Standard KFold is inadequate for time series due to leakage risk. This custom splitter:

- Divides data into `n_splits` folds.
- **Purges** training samples that fall within a `purging_window` (time gap before and after validation fold).
- Applies an optional **embargo_window** after the validation fold to further prevent leakage.

This ensures clean temporal separation between training and validation, mitigating lookahead bias.

---

### 6. Model Training: `model_train`

Handles end-to-end training within an MLflow experiment:

- Loads experiment configuration dynamically.
- Fits the supplied pipeline on training data.
- Logs the trained pipeline artifact and accuracy metrics to MLflow.

**Returns:**
- The trained pipeline (ready for production).

---

### 7. Model Assessment: `find_champion_model`

This step involves automated hyperparameter tuning and cross-validation to identify the best-performing model configuration using user-defined parameters:

- Parameters and hyperparameters are injected via Kedro `params`.
- Cross-validation arguments and scoring metrics are customizable.
- The champion model is selected based on validation performance.

---

### 8. Model Prediction: `make_predictions`

A lightweight function that:

- Accepts a trained pipeline and a test feature set.
- Outputs predictions as a pandas Series indexed by the input test data.
- Logs prediction events for traceability.

---

## Technology Stack

- **Kedro:** Pipeline orchestration and reproducibility.
- **scikit-learn:** Modeling, feature selection, scaling.
- **MLflow:** Experiment tracking, model logging, and deployment.
- **Pandas & NumPy:** Data manipulation and numerical operations.
- **Matplotlib:** Visualization of model outputs.

---

*For detailed node-level implementation and API references, see the documentation generated by Sphinx in the `docs` folder.*
